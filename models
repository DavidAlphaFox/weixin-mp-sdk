-- 这里定义的若干 Model 是主要为 StoreInMsgToDB “标准”消息处理器而设计


-- | incoming message
WxppInMsgRecord
    app                 WxppAppID maxlen=200
    to                  Text Maybe
                            -- ^ Nothing only if we cannot parse the message propertly
    from                WxppOpenID Maybe
                            -- ^ Nothing only if we cannot parse the message propertly
    createdTime         UTCTime Maybe
                            -- ^ Nothing only if we cannot parse the message propertly
    extId               WxppInMsgID Maybe maxlen=200
                            -- ^ Nothing if we cannot parse the message propertly
                            -- or it is an event notification

    blob                ByteString          -- ^ unencrypted message bytestring
    notifyTime          UTCTime

    UniqueWxppInMsgRecord extId app !force


-- | 永久保存可能会失效的数据
-- 因为各种媒体文件只有短时间内有效，这个表把这些文件支持保存到本地数据库
WxppStoredMedia
    app                 WxppAppID maxlen=200
    extId               WxppMediaID maxlen=200
    msg                 WxppInMsgRecordId
    blob                ByteString
    mime                ByteString
    saveTime            UTCTime

    UniqueWxppStoredMedia extId app msg
            -- ^ 按文档，WxppMediaID可能会被重用
            -- 因此加上它所相关联的消息作为
